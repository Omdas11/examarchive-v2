// js/login-modal.js
// ===================================
// Login Modal Controller (Google only)
// MOBILE DEBUG VERSION (ALERT BASED)
// ===================================

import { account } from "./appwrite.js";

alert("âœ… login-modal.js LOADED");

function waitForModal() {
  const modal = document.querySelector(".login-modal");
  const loginBtn = document.querySelector(".login-trigger");
  const googleBtn = document.querySelector('[data-provider="google"]');
  const closeBtn = document.querySelector(".modal-close");

  if (!modal) {
    alert("â³ Modal NOT found yet");
    return setTimeout(waitForModal, 300);
  }

  if (!loginBtn) {
    alert("âŒ Login button NOT found");
    return;
  }

  if (!googleBtn) {
    alert("âŒ Google button NOT found (data-provider=google missing)");
    return;
  }

  alert("ğŸ”¥ Login modal + buttons FOUND");

  // OPEN MODAL
  loginBtn.addEventListener("click", () => {
    alert("ğŸŸ¢ LOGIN BUTTON CLICKED");
    modal.classList.add("open");
  });

  // CLOSE MODAL
  closeBtn?.addEventListener("click", () => {
    alert("âŒ MODAL CLOSED");
    modal.classList.remove("open");
  });

  // GOOGLE LOGIN
  googleBtn.addEventListener("click", () => {
    alert("ğŸš€ GOOGLE BUTTON CLICKED");

    const redirect = window.location.origin;
    alert("â¡ï¸ Redirect URL: " + redirect);

    account.createOAuth2Session(
      "google",
      redirect,
      redirect
    );
  });
}

waitForModal();
