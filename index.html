<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ExamArchive — University Question Paper Archive</title>

  <link rel="stylesheet" href="css/common.css" />
  <link rel="stylesheet" href="css/brand.css" />
  <link rel="stylesheet" href="css/avatar-popup.css">
  <link rel="stylesheet" href="css/header.css" />
  <link rel="stylesheet" href="css/footer.css">
  <link rel="stylesheet" href="css/profile-panel.css">
  <link rel="stylesheet" href="css/levelup.css">
  <link rel="stylesheet" href="css/avatar.css">
  <link rel="stylesheet" href="css/home.css" />

  <!-- SEO -->
  <meta name="description" content="ExamArchive — A community-driven archive of university question papers. Browse, upload, and preserve previous year papers for Assam University and beyond." />
  <meta name="keywords" content="exam archive, question papers, university papers, previous year papers, Assam University, FYUG, exam preparation" />
  <meta name="author" content="ExamArchive" />
  <meta name="theme-color" content="#d32f2f" />
  <link rel="canonical" href="https://examarchive.in/" />

  <!-- Open Graph -->
  <meta property="og:title" content="ExamArchive — University Question Paper Archive" />
  <meta property="og:description" content="Browse, upload, and preserve university question papers. Community-driven, mobile-first academic archive." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://examarchive.in/" />
  <meta property="og:site_name" content="ExamArchive" />
</head>
<body>

  <!-- Skip to content link for accessibility -->
  <a href="#main-content" class="sr-only sr-only-focusable">Skip to main content</a>

  <!-- Header include -->
  <div id="night-layer"></div>
  <div id="header"></div>

  <main class="home" id="main-content">

    <!-- ================= HERO ================= -->
    <section class="hero" aria-label="Welcome section">
      <h1 class="typewriter" id="heroTitle" aria-label="ExamArchive"></h1>
      <p>
        A simple and community-driven archive of university question papers.
        Browse, upload, and preserve papers for everyone.
      </p>

      <div class="hero-actions" role="navigation" aria-label="Main actions">
        <a href="browse.html" class="btn btn-red">Browse Papers</a>
        <a href="upload.html" class="btn">Upload Paper</a>
        <a href="login.html" class="btn" id="heroLoginBtn">Login</a>
        <a href="profile.html" class="btn" id="heroProfileBtn" style="display:none;">Profile</a>
        <a href="admin/dashboard/" class="btn" id="heroAdminBtn" style="display:none;">Admin</a>
      </div>
    </section>

    <!-- ================= UNIVERSAL SEARCH ================= -->
    <section class="home-search" aria-label="Search papers">
      <div class="search-wrapper">

        <div class="search-bar" role="search">
          <input
            type="text"
            class="search-input"
            placeholder="Search papers, repeated questions, notes, references…"
            aria-label="Universal search"
          />

          <button type="button" class="search-mode-btn" id="searchModeBtn" aria-haspopup="true" aria-expanded="false">
            Universal
          </button>

          <button type="button" class="btn btn-red search-btn" aria-label="Perform search">
            Search
          </button>
        </div>

        <div class="search-mode-dropdown" id="searchModeDropdown">
          <button data-mode="universal" class="active">Universal</button>
          <button data-mode="papers">Question Papers (PDF)</button>
          <button data-mode="rq">Repeated Questions</button>
          <button data-mode="notes">Notes</button>
          <button data-mode="refs">References</button>
        </div>

        <div class="search-results"></div>

      </div>
    </section>

    <!-- ================= NOTICE BOARD ================= -->
    <section class="notice-board" aria-label="University notices">
      <h2>Notices & Updates</h2>
      <div class="notice-box" role="region" aria-live="polite">
        <p class="notice-empty">
          University notices and important academic updates will appear here.
        </p>
      </div>
    </section>

    <!-- ================= ACADEMIC CALENDAR ================= -->
    <section class="academic-calendar" aria-label="Academic calendar">
      <h2>Academic Calendar — 2026</h2>
      <div class="calendar-controls" style="display: flex; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap;">
        <button class="toggle-btn active" data-cat="all" onclick="filterCalendar('all', this)">All</button>
        <button class="toggle-btn" data-cat="gazetted" onclick="filterCalendar('gazetted', this)">Gazetted</button>
        <button class="toggle-btn" data-cat="restricted" onclick="filterCalendar('restricted', this)">Restricted</button>
        <button class="toggle-btn" data-cat="other" onclick="filterCalendar('other', this)">Academic</button>
      </div>
      <div class="calendar-month-nav" style="display: flex; align-items: center; justify-content: center; gap: 1rem; margin-bottom: 1rem;">
        <button class="btn" id="calPrev" aria-label="Previous month">&larr;</button>
        <strong id="calMonthLabel" style="min-width: 140px; text-align: center;"></strong>
        <button class="btn" id="calNext" aria-label="Next month">&rarr;</button>
      </div>
      <div id="calendarGrid" class="calendar-box" role="region" aria-live="polite">
        <p class="calendar-empty">Loading calendar...</p>
      </div>
      <div id="calendarEventDetail" style="margin-top: 1rem; display: none;"></div>
    </section>

  </main>

  <!-- Footer include -->
  <div id="footer"></div>

  <!-- ✅ GLOBAL PORTALS (MUST COME BEFORE JS) -->
  <div id="avatar-portal"></div>
  <div id="profile-panel-portal"></div>

  <!-- Scripts -->
  <!-- ⚡ BOOTSTRAP (MUST BE FIRST) -->
  <script src="js/bootstrap.js"></script>
  
  <!-- Supabase SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.93.3"></script>
  
  <!-- ⚡ SUPABASE CLIENT SINGLETON (Phase 1.4 - MUST LOAD BEFORE MODULES) -->
  <script src="js/supabase-client.js"></script>
  <script src="js/core/debug.js"></script>
  
  <!-- ⚡ SUPABASE INITIALIZATION (Phase 9.2.4) -->
  <script type="module" src="js/app.module.js"></script>
  
  <!-- Classic Scripts (NO type="module") -->
  <!-- ⚡ AUTH UTILITIES (Phase 9.2) -->
  <script src="js/utils/supabase-wait.js"></script>
  <script src="js/auth-controller.js"></script>
  
  <script src="js/common.js"></script>
  <script src="js/avatar-utils.js"></script>
  <script src="js/utils/role-utils.js"></script>
  <script src="js/svg-icons.js"></script>
  <script src="js/roles.js"></script>
  <script src="js/admin-auth.js"></script>
  <script src="js/profile-panel.js"></script>
  <script src="js/levelup.js"></script>
  <script src="js/avatar-popup.js"></script>
  <script src="js/theme.js"></script>
  <script src="js/home-search.js"></script>
  <script src="js/notices-calendar.js"></script>
  <script src="js/tutorial.js"></script>
  <script src="js/visitor-counter.js"></script>
  <script>
  // Typewriter animation — plays once per page load, then static
  (function() {
    var el = document.getElementById('heroTitle');
    if (!el) return;
    var text = 'ExamArchive';
    var i = 0;
    function type() {
      if (i <= text.length) {
        el.textContent = text.slice(0, i);
        i++;
        setTimeout(type, 90);
      } else {
        el.classList.add('done');
      }
    }
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', type);
    } else {
      type();
    }
  })();

  // Hero button visibility based on auth state
  (function() {
    async function updateHeroButtons() {
      var loginBtn = document.getElementById('heroLoginBtn');
      var profileBtn = document.getElementById('heroProfileBtn');
      var adminBtn = document.getElementById('heroAdminBtn');
      try {
        var supabase = window.getSupabase ? window.getSupabase() : null;
        if (!supabase) supabase = window.waitForSupabase ? await window.waitForSupabase() : null;
        if (!supabase) return;
        var res = await supabase.auth.getSession();
        var session = res.data.session;
        if (session) {
          if (loginBtn) loginBtn.style.display = 'none';
          if (profileBtn) profileBtn.style.display = '';
          // Check if user has admin access
          try {
            var roleRes = await supabase.from('roles').select('primary_role').eq('user_id', session.user.id).single();
            var role = roleRes.data ? roleRes.data.primary_role : null;
            if (role && ['Founder', 'Admin', 'Senior Moderator'].includes(role)) {
              if (adminBtn) adminBtn.style.display = '';
            }
          } catch(e) {}
        }
      } catch(e) {}
    }
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function() { setTimeout(updateHeroButtons, 500); });
    } else {
      setTimeout(updateHeroButtons, 500);
    }
  })();
  </script>
</body>
</html>
